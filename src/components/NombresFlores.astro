---
// NombresFlores.astro (ComponenteInvitacion.astro)
---

<section class="relative bg-white w-full min-h-screen overflow-hidden">
    
    <!-- REPRODUCTOR DE M√öSICA - Fijo en la esquina superior derecha SIN EFECTOS -->
    <div id="reproductor-fijo" class="fixed top-4 right-4 z-40">
        
        <!-- C√≠rculo del reproductor con efecto blur -->
        <button 
            id="btn-reproducir"
            class="relative w-16 h-16 sm:w-20 sm:h-20 rounded-full backdrop-blur-md bg-gradient-to-br from-[#C9A961]/30 to-[#6B7154]/30 shadow-xl flex items-center justify-center border-2 border-white/40"
            title="Reproducir/Pausar m√∫sica"
        >
            <!-- √çcono de Play -->
            <svg 
                id="icono-play" 
                class="hidden w-6 h-6 sm:w-8 sm:h-8 text-white drop-shadow-lg"
                fill="currentColor" 
                viewBox="0 0 24 24"
            >
                <path d="M8 5v14l11-7z"/>
            </svg>
            
            <!-- √çcono de Pause (visible al inicio) -->
            <svg 
                id="icono-pause" 
                class="w-6 h-6 sm:w-8 sm:h-8 text-white drop-shadow-lg"
                fill="currentColor" 
                viewBox="0 0 24 24"
            >
                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
        </button>
    </div>

    <!-- Audio element (oculto) SIN autoplay -->
    <audio id="audio-player" preload="auto" loop>
        <source src="/audio/melodia.mp3" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
    </audio>

    <!-- Imagen Principal con desvanecimiento -->
    <div class="relative w-full">
        <!-- Imagen principal -->
        <div class="relative w-full h-[500px] sm:h-[600px] md:h-[700px]">
            <img
                id="imagen-principal"
                src="/imagenes/fotoprincipal.webp"
                alt="Foto de los novios"
                class="w-full h-full object-cover"
            />
            
            <!-- Degradado de desvanecimiento -->
            <div id="degradado" class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-white to-transparent"></div>
        </div>
    </div>

    <!-- Texto de invitaci√≥n -->
    <div id="texto-invitacion" class="relative w-full px-6 py-8 text-center">
        <p class="font-serif text-gray-700 text-base sm:text-lg md:text-xl tracking-wide">
            TENEMOS EL HONOR<br />
            DE INVITARTE A NUESTRA BODA
        </p>
    </div>

    <!-- Contenedor del aro con nombres -->
    <div class="relative w-full flex justify-center pb-12">
        <div class="relative w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96">
            <!-- Imagen del aro -->
            <img
                id="aro-decorativo"
                src="/imagenes/aro.webp"
                alt="Aro decorativo"
                class="w-full h-full object-contain"
            />
            
            <!-- Nombres de los novios centrados -->
            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <h2 id="nombre-john" class="font-great-vibes text-5xl sm:text-6xl md:text-7xl text-[#C9A961] tracking-wide">
                    John
                </h2>
                <div id="ampersand" class="text-[#C9A961] text-3xl sm:text-4xl md:text-5xl font-charm my-2">
                    &
                </div>
                <h2 id="nombre-damarys" class="font-great-vibes text-5xl sm:text-6xl md:text-7xl text-[#C9A961] tracking-wide">
                    Damarys
                </h2>
            </div>
        </div>
    </div>

</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- üé¨ ANIMACIONES CON GSAP Y REPRODUCTOR                       -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
    import { gsap } from "gsap";

    document.addEventListener("DOMContentLoaded", () => {
        console.log("üéä Iniciando animaciones de invitaci√≥n...");

        // ‚ïê‚ïê‚ïê REPRODUCTOR DE M√öSICA - Inicia autom√°ticamente cuando se carga el componente ‚ïê‚ïê‚ïê
        const audio = document.getElementById("audio-player") as HTMLAudioElement;
        const btnReproducir = document.getElementById("btn-reproducir");
        const iconoPlay = document.getElementById("icono-play");
        const iconoPause = document.getElementById("icono-pause");

        let estaReproduciendo = false;

        // Funci√≥n para intentar reproducir con manejo de errores
        const intentarReproducir = async () => {
            try {
                await audio?.play();
                estaReproduciendo = true;
                iconoPlay?.classList.add("hidden");
                iconoPause?.classList.remove("hidden");
                console.log("üéµ M√∫sica iniciada autom√°ticamente");
            } catch (error) {
                console.log("‚ö†Ô∏è No se pudo reproducir autom√°ticamente, esperando interacci√≥n del usuario");
                estaReproduciendo = false;
                iconoPlay?.classList.remove("hidden");
                iconoPause?.classList.add("hidden");
            }
        };

        // ‚≠ê INICIAR M√öSICA AUTOM√ÅTICAMENTE AL CARGAR ESTE COMPONENTE
        // Peque√±o delay para asegurar que el componente est√° completamente cargado
        setTimeout(() => {
            intentarReproducir();
        }, 300);

        // Backup: intentar reproducir con la primera interacci√≥n si fall√≥ el autoplay
        const iniciarConInteraccion = () => {
            if (!estaReproduciendo) {
                intentarReproducir();
            }
        };

        // Escuchar una sola vez cualquier clic en la p√°gina
        document.addEventListener("click", iniciarConInteraccion, { once: true });
        document.addEventListener("touchstart", iniciarConInteraccion, { once: true });

        // Funcionalidad del bot√≥n play/pause
        btnReproducir?.addEventListener("click", (e) => {
            e.stopPropagation(); // Evitar que active el listener de iniciarConInteraccion
            
            if (!estaReproduciendo) {
                // Reproducir m√∫sica
                audio?.play();
                estaReproduciendo = true;
                
                // Cambiar iconos
                iconoPlay?.classList.add("hidden");
                iconoPause?.classList.remove("hidden");
                
            } else {
                // Pausar m√∫sica
                audio?.pause();
                estaReproduciendo = false;
                
                // Cambiar iconos
                iconoPlay?.classList.remove("hidden");
                iconoPause?.classList.add("hidden");
            }
        });

        // Reiniciar cuando termine la canci√≥n (aunque tiene loop)
        audio?.addEventListener("ended", () => {
            estaReproduciendo = false;
            iconoPlay?.classList.remove("hidden");
            iconoPause?.classList.add("hidden");
        });

        // ‚ïê‚ïê‚ïê IMAGEN PRINCIPAL - Fade in desde arriba ‚ïê‚ïê‚ïê
        gsap.fromTo(
            "#imagen-principal",
            { opacity: 0, y: -50 },
            { opacity: 1, y: 0, duration: 1, ease: "power2.out", delay: 0 }
        );

        // ‚ïê‚ïê‚ïê DEGRADADO - Aparece despu√©s de la imagen ‚ïê‚ïê‚ïê
        gsap.fromTo(
            "#degradado",
            { opacity: 0 },
            { opacity: 1, duration: 0.8, ease: "power2.out", delay: 0.5 }
        );

        // ‚ïê‚ïê‚ïê TEXTO DE INVITACI√ìN - Fade in desde abajo ‚ïê‚ïê‚ïê
        gsap.fromTo(
            "#texto-invitacion",
            { opacity: 0, y: 30 },
            { opacity: 1, y: 0, duration: 0.8, ease: "power2.out", delay: 0.8 }
        );

        // ‚ïê‚ïê‚ïê ARO DECORATIVO - Scale desde el centro ‚ïê‚ïê‚ïê
        gsap.fromTo(
            "#aro-decorativo",
            { opacity: 0, scale: 0.3, rotation: -10 },
            { opacity: 1, scale: 1, rotation: 0, duration: 1, ease: "back.out(1.7)", delay: 1.2 }
        );

        // ‚ïê‚ïê‚ïê NOMBRE JOHN - Letra por letra ‚ïê‚ïê‚ïê
        const textoJohn = "John";
        const contenedorJohn = document.getElementById("nombre-john");
        if (contenedorJohn) {
            contenedorJohn.innerHTML = textoJohn
                .split("")
                .map(
                    (letra, index) =>
                        `<span class="letra-animada" style="
                            opacity: 0; 
                            display: inline-block; 
                            transform: translateY(20px) scale(0.8);
                            filter: blur(3px);
                        ">${letra}</span>`
                )
                .join("");

            gsap.to("#nombre-john .letra-animada", {
                opacity: 1,
                y: 0,
                scale: 1,
                filter: "blur(0px)",
                duration: 0.5,
                ease: "power2.out",
                stagger: { each: 0.05, from: "start" },
                delay: 1.6
            });
        }

        // ‚ïê‚ïê‚ïê S√çMBOLO & - Scale con bounce ‚ïê‚ïê‚ïê
        gsap.fromTo(
            "#ampersand",
            { opacity: 0, scale: 0.5 },
            { opacity: 1, scale: 1, duration: 0.6, ease: "back.out(2)", delay: 2 }
        );

        // ‚ïê‚ïê‚ïê NOMBRE DAMARYS - Letra por letra ‚ïê‚ïê‚ïê
        const textoDamarys = "Damarys";
        const contenedorDamarys = document.getElementById("nombre-damarys");
        if (contenedorDamarys) {
            contenedorDamarys.innerHTML = textoDamarys
                .split("")
                .map(
                    (letra, index) =>
                        `<span class="letra-animada" style="
                            opacity: 0; 
                            display: inline-block; 
                            transform: translateY(20px) scale(0.8);
                            filter: blur(3px);
                        ">${letra}</span>`
                )
                .join("");

            gsap.to("#nombre-damarys .letra-animada", {
                opacity: 1,
                y: 0,
                scale: 1,
                filter: "blur(0px)",
                duration: 0.5,
                ease: "power2.out",
                stagger: { each: 0.05, from: "start" },
                delay: 2.2
            });
        }

        // ‚ïê‚ïê‚ïê ROTACI√ìN SUAVE DEL ARO (loop infinito) ‚ïê‚ïê‚ïê
        gsap.to("#aro-decorativo", {
            rotation: 5,
            duration: 3,
            ease: "sine.inOut",
            yoyo: true,
            repeat: -1,
            delay: 3
        });

        console.log("‚ú® Animaciones completadas!");
    });
</script>

<style>
    /* Asegurar que las im√°genes carguen correctamente */
    img {
        display: block;
    }
    
    /* Efecto hover en letras animadas */
    .letra-animada {
        transition: all 0.3s ease;
        will-change: transform, opacity, filter;
        position: relative;
    }

    .letra-animada:hover {
        transform: translateY(-3px) scale(1.1) !important;
        text-shadow: 0 0 15px rgba(201, 169, 97, 0.5) !important;
    }

    /* Responsivo */
    @media (max-width: 640px) {
        #reproductor-fijo {
            top: 0.75rem;
            right: 0.75rem;
        }
    }
</style>